# 调试日志说明

## 概述

QueueSend 自动化程序现在在运行时会自动生成详细的调试日志，保存在项目根目录的 `debug.log` 文件中。

## 日志位置

- **文件路径**: `QueueSend/debug.log`
- **编码**: UTF-8
- **更新方式**: 实时追加写入

## 日志内容

调试日志记录了自动化过程中的所有关键操作和状态变化，包括：

### 1. 自动化流程控制
- 工作线程启动和结束
- 状态转换（Idle → Countdown → Sending → Cooling → WaitingHold → Paused）
- 倒计时过程
- 暂停/恢复/停止操作

### 2. 消息处理
- 每条消息的处理开始
- 消息内容（前100字符）
- 消息长度和进度

### 3. 鼠标和键盘操作
- 点击输入点的坐标和时间
- 点击发送点的坐标和时间
- 鼠标移动和点击结果
- 剪贴板设置（文本长度、是否跨行）
- 粘贴快捷键发送

### 4. 截图和图像处理
- ROI 区域截图开始和完成
- 截图重试次数
- 图像尺寸和形状
- 参考帧（frame_t0）捕获
- 当前帧（frame_t）采样

### 5. 变化检测
- Diff 值计算
- Hold hits 计数变化
- 阈值比较结果
- 连续命中检测
- 循环迭代次数

### 6. 异常和错误
- 完整的异常堆栈信息
- 错误类型和消息
- 失败的操作上下文

## 日志格式

每条日志记录包含：

```
[时间戳] [级别] 消息内容 (上下文信息)
```

**示例**：
```
[2025-01-03 14:23:45.123] [INFO] 开始自动化: 5条消息 (roi_rect=(100,200,300x400), input_point=(150,250), send_point=(180,320), th_hold=0.015000)
[2025-01-03 14:23:46.456] [DEBUG] 点击输入点: (150, 250) (idx=0)
[2025-01-03 14:23:46.567] [DEBUG] 粘贴消息完成 (idx=0, msg_len=42)
[2025-01-03 14:23:47.890] [INFO] 采集frame_t0 (frame_shape=(400, 300), idx=0)
[2025-01-03 14:23:48.123] [INFO] 采样 (state=WaitingHold, progress=1/5, diff=0.003456, hold_hits=0)
```

## 日志级别

- **DEBUG**: 详细的调试信息（鼠标移动、截图细节等）
- **INFO**: 一般信息（状态变化、操作完成）
- **WARNING**: 警告信息（粘贴可能失败、重试等）
- **ERROR**: 错误信息（操作失败、异常）

## 使用建议

### 排查崩溃问题

1. **查看最后的日志条目**: 程序崩溃前的最后几条日志可以帮助定位问题
2. **检查异常信息**: 搜索 `[ERROR]` 级别的日志查看完整的异常堆栈
3. **追踪操作序列**: 按时间顺序查看操作流程，找出异常发生的环节

### 常见问题定位

| 问题现象 | 检查日志中的内容 |
|---------|----------------|
| 程序突然退出 | 最后几条日志，查看是否有异常或错误 |
| 点击失败 | 搜索 "点击" 相关日志，检查坐标和错误信息 |
| 粘贴失败 | 搜索 "粘贴" 或 "剪贴板"，检查设置是否成功 |
| 截图失败 | 搜索 "截图" 或 "capture"，查看重试次数和错误 |
| 变化检测异常 | 查看 diff 值和 hold_hits 的变化趋势 |
| 卡在某个消息 | 查看循环迭代次数（loop_iteration）是否异常增长 |

### 性能分析

- 查看每条消息的处理时间
- 统计 WaitingHold 阶段的循环次数
- 识别可能的性能瓶颈

## 日志管理

- **自动清理**: 每次启动应用程序时，会自动清空旧的日志
- **文件大小**: 日志文件会持续增长，建议定期备份或删除
- **隐私注意**: 日志中可能包含消息内容的前100个字符，请妥善保管

## 技术细节

### 线程安全
所有日志写入操作都是线程安全的，支持从主线程和工作线程同时写入。

### 性能影响
日志系统设计为轻量级，对自动化性能的影响极小（< 1ms per log entry）。

### 错误处理
即使日志写入失败，也不会影响自动化流程的正常执行。

## 反馈问题时

如果需要报告程序问题，请：
1. 复现问题
2. 保存 `debug.log` 文件
3. 说明问题发生的时间点
4. 提供日志文件和问题描述

这将大大帮助开发者快速定位和修复问题。

